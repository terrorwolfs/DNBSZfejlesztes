{"chunk":0,"numChunks":3,"fileHash":"LHMScAiY0VFmAb5e9VXsmyeCoBUzaa8HahqcB1nn0dM=","filePath":"FlaskWebProject/WebApp/routes.py","content":"from flask import render_template, url_for, flash, redirect, request, Blueprint, session\nfrom WebApp import db\nfrom datetime import datetime\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom .forms import RegistrationForm, LoginForm, BookingForm\nfrom .models import User, Room, Booking\nfrom .auth import login_required, admin_required\nroutes = Blueprint('routes', __name__)\n@routes.route(\"/\")\n@routes.route(\"/index\")\ndef index():\n    rooms = Room.query.all()\n    return render_template('index.html', rooms=rooms)\n@routes.route(\"/register\", methods=['GET', 'POST'])\ndef register():\n    if 'user_id' in session:\n        return redirect(url_for('routes.index'))\n    form = RegistrationForm()\n    if form.validate_on_submit():\n        hashed_password = generate_password_hash(form.password.data)\n        user = User(username=form.username.data, email=form.email.data, password=hashed_password, is_admin=False)\n        db.session.add(user)\n        db.session.commit()\n        flash('Your account has been created! You are now able to log in', 'success')\n        return redirect(url_for('routes.login'))\n    return render_template('register.html', title='Register', form=form)\n@routes.route(\"/login\", methods=['GET', 'POST'])\ndef login():\n    if 'user_id' in session:\n        return redirect(url_for('routes.index'))\n    form = LoginForm()\n    if form.validate_on_submit():\n        user = User.query.filter_by(email=form.email.data).first()\n        if user and check_password_hash(user.password, form.password.data):\n            session['user_id'] = user.id\n            session['username'] = user.username\n            next_page = request.args.get('next')\n            return redirect(next_page) if next_page else redirect(url_for('routes.index'))\n        else:\n            flash('Login Unsuccessful. Please check email and password', 'danger')\n    return render_template('login.html', title"}